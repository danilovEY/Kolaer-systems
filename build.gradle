group = "ru.kolaer"

allprojects {
    repositories {
        mavenCentral()
        jcenter()
        mavenLocal()
    }

    task wrapper(type: Wrapper) {
        gradleVersion = 1.11
    }
}

project(":api") {
    apply plugin: 'java'

    compileJava.options.encoding = 'UTF-8'
    sourceCompatibility = 1.8
}

project(":client") {
    allprojects {
        ext {
            pathToProjectDir = "D:\\Kolaer-systems"
            pathToProjectDirWithPlugins = pathToProjectDir + "\\plugins"
        }
    }

    subprojects {
        apply plugin: 'java'

        if(name.equals("usa")) {
            dependencies {
                compile(project(':api'))
            }
        } else {
            dependencies {
                compile(project(':api')) {
                    exclude group: 'com.fasterxml.jackson.core'
                }
            }
        }

        compileJava.options.encoding = 'UTF-8'
        sourceCompatibility = 1.8
    }

    task makePretty() {
        delete pathToProjectDirWithPlugins
    }

    task makeProjectDirTask (dependsOn: makePretty) {
        doLast {
            mkdir(pathToProjectDir)
            mkdir(pathToProjectDirWithPlugins)
        }
    }
}

project(":server") {
    subprojects {
        apply plugin: 'java'
        apply plugin: 'war'

        ext {
            deployServerPath = "\\\\js\\c\$\\apache-tomcat-8.5.4\\webapps"
        }

        compileJava.options.encoding = 'UTF-8'
        sourceCompatibility = 1.8
    }
}

//================================Clients================================//
task buildMainClient (dependsOn: ':client:usa:buildApp')
task buildPlugins (dependsOn: [':client:asmc:buildApp',
                               ':client:psr:buildApp',
                               ':client:admin:buildApp',
                               ':client:birthday:buildApp',
                               ':client:browser:buildApp'])
task buildClient (dependsOn: [buildMainClient, buildPlugins])

//================================Servers================================//
task buildRestFul (dependsOn: ":server:restful:buildApp")
task buildWebPortal (dependsOn: ":server:webportal:buildApp")
task buildServer (dependsOn: [buildRestFul, buildWebPortal])

//================================Globals================================//
task preparePreBuild(dependsOn: ":client:makeProjectDirTask")
task buildKolaerSystem(dependsOn: [preparePreBuild, buildServer, buildClient])